<!DOCTYPE html>
<html>
  <head>
    <title>Musical Preference Survey</title>
    <script src="../jspsych.js"></script>
    <script src="../plugins/jspsych-html-keyboard-response.js"></script>
    <script src="../plugins/jspsych-survey-multi-choice.js"></script>
    <script src="../plugins/jspsych-survey-text.js"></script>
    <script src="../plugins/jspsych-instructions.js"></script>
    <script src="../plugins/jspsych-audio-button-response.js"></script>
    <script src="../plugins/jspsych-html-button-response.js"></script>
    <script src="../plugins/jspsych-image-button-response.js"></script>
    <script src="../plugins/jspsych-iat-image.js"></script>
    <script src="../plugins/jspsych-iat-html.js"></script>
    <script src="../plugins/jspsych-survey-likert.js"></script>
    <link rel="stylesheet" href="../css/jspsych.css"></link>
  </head>
  <body></body>
  <script>

  var page_1_questions = ["What is the Sex you were assigned at birth?", "What is your current gender identity?"];
  var page_2_questions = ["What is your current age?", "What is your country of primary citizenship?", "What is the postal code (or name) of the place you have lived the longest?"];
  var page_3_questions = ["What is your race?", "What is your ethnicity?"];
  var page_4_questions = ["What is your political identity?"];
  var page_5_questions = ["What is your religious affiliation?"];
  var page_6_questions = ["How religious do you consider yourself to be?"];
  var page_7_questions = ["What is the highest level of education you have completed?"];

  var page_1_options = ["Male", "Female"];
  var page_2_options = ["Male", "Female", "Trans Male", "Trans Female", "Gender nonconforming", "other"];
  var page_3_options = ["American Indian/Alaska Native", "East Asian", "South Asian", "Native Hawaiian or other Pacific Islander", "Black or African American", "White", "other or unknown"];
  var page_4_options = ["Hispanic or Latino", "Not Hispanic or Latino", "Unknown"];
  var page_5_options = ["Strongly Conservative", "Moderately Conservative", "Slightly Conservative", "Neutral/No Political affiliation", "Slightly Liberal", "Moderately Liberal", "Strongly Liberal"];
  var page_6_options = ["Buddhist/Confucian/Shinto", "Christian: Catholic or Orthodox", "Christian: Protestant or other", "Jewish", "Hindu", "Muslim", "other"];
  var page_7_options = ["Strongly religious", "Moderately religious", "Slightly religious", "Not at all religious"];
  var page_8_options = ["High School", "Associate's Degree", "Some College", "Bachelor's degree", "Master's degree", "Doctoral degree", "Other"];

  var scale_1 = ["Strongly Disagree", "Disagree", "Neutral", "Agree", "Strongly Agree"];
  var scale_2 = ["Extremely cold", "Moderately cold", "Slightly cold", "Neutral", "Slightly warm", "Moderately warm", "Extremely warm"];
  var scale_3 = ["I strongly prefer white people to black people.", "I moderately prefer white people to black people.", "I slightly prefer white people to black people.", "I like white people and black people equally.", "I slightly prefer black people to white people.", "I moderately prefer black people to white people.", "I strongly prefer black people to white people."];

  var audio1 = ['sound/Lyla Lou_02.wav', 'sound/Karola_02.wav', 'sound/Everyday_02.wav',
'sound/Biding her time _02.wav',
'sound/j Uh!_02.wav',
'sound/When Me A Move _02.wav',
'sound/Kopla ja kummisetA$_ _02.wav',
'sound/Made Like This_02.wav',
'sound/Turn Your Radio On _02.wav',
'sound/Just Keep It Up _02.wav',
'sound/NAPSo Adianta _02.wav',
'sound/Horns of the Buul _02.wav',
'sound/Sing Me Softly of the Blues _02.wav',
'sound/Duh Duh Da _02.wav',
'sound/Iki Tas Corba _02.wav',
'sound/Wicked Little Town _02.wav',
'sound/Out Of My Darkness _02.wav',
'sound/Piracy_02.wav',
'sound/YksinA$_isin_02.wav',
'sound/Morning _02.wav',
'sound/Blood Will Fall_02.wav',
'sound/When Jesus Comes Calling For Me _02.wav',
'sound/No Love To Give _02.wav',
'sound/Dubrovnic_02.wav',
'sound/Estoy AquA_02.wav',
'sound/Sleeping My Day Away _02.wav',
'sound/Cero Codazos_02.wav'];

  var audio2 = ['sound/Lyla Lou_01.wav', 'sound/Karola_01.wav', 'sound/Everyday_01.wav',
'sound/Biding her time _01.wav',
'sound/Gentle_ the Night _01.wav',
'sound/Wicked Little Town _01.wav',
'sound/When Me A Move _01.wav',
'sound/Dubrovnic_01.wav',
'sound/Made Like This_01.wav',
'sound/Iki Tas Corba _01.wav',
'sound/Estoy AquA_01.wav',
'sound/The Sukkubus Lustrate _01.wav',
'sound/Rock N Roll _01.wav',
'sound/Turntable Terrorist _01.wav',
'sound/NAPSo Adianta _01.wav',
'sound/Lake Of Dreams _01.wav',
'sound/This Train (Munk Edit)_01.wav',
'sound/Duh Duh Da _01.wav',
'sound/The Thrill is Gone _01.wav',
'sound/A Little Tear _01.wav',
'sound/The Loco Motion _01.wav',
'sound/When Jesus Comes Calling For Me _01.wav',
'sound/Atotonilco _01.wav',
'sound/INAWIWY_01.wav',
'sound/Sunday In Marin _01.wav',
'sound/Blood Will Fall _01.wav'];

  var timeline = [];

  var instructions = {
    type: 'instructions',
    pages: [
        'Welcome!',
        'In this experiment, you will be asked to listen to and rate several short song clips on a "likeability" scale from 1-7. ' +
        'There will be two groups of song clips, with a short break in between.',
        'First, you will be asked some basic demographic questions. '+
        'After the music clips, you will fill out a brief exit survey. ',
        'Click next to begin.'
    ],
    post_trial_gap: 1500,
    show_clickable_nav: true
};
timeline.push(instructions);

var survey_trial = {
  timeline: [
    {
      type: 'survey-multi-choice',
      questions: [{prompt: "<big>What is the Sex you were assigned at birth?</big>", options: page_1_options,}, {prompt: "<big>What is your current gender identity?</big>", options: page_2_options}],
    },
    {
  type: 'survey-text',
  questions: [{prompt: "<big>What is your current age?</big>"}, {prompt: "<big>What is your country and/or state of primary residence?</big>"}, {prompt: "<big>What is the postal code of the place you have lived the longest?</big>"}],
},
  {
      type: 'survey-multi-choice',
      questions: [{prompt: "<big>What is your race?</big>", options: page_3_options,}, {prompt: "<big>What is your ethnicity?</big>", options: page_4_options,}],
  },
  {
    type: 'survey-multi-choice',
    questions: [{prompt: "<big>What is your political identity?</big>", options: page_5_options,}],
  },
  {
    type: 'survey-multi-choice',
    questions: [{prompt: "<big>What is your religious afiliation?</big>", options: page_6_options,}],
  },
  {
    type: 'survey-multi-choice',
    questions: [{prompt: "<big>How religious do you consider yourself to be?</big>", options: page_7_options, horizontal: false}],
  },
  {
    type: 'survey-multi-choice',
    questions: [{prompt: "<big>What is the highest level of education you have completed?</big>", options: page_8_options}],
  },
],
};
timeline.push(survey_trial);

var instructions1 = {
  type: 'instructions',
  pages: [
      'This concludes the survey portion of the experiment.',
      'Before moving on, you will be shown a short news article. Please read the entire article, then click Continue to begin block one.',
  ],
  post_trial_gap: 1500,
  show_clickable_nav: true
};
timeline.push(instructions1);

  //ADD ARTICLES IN FULL!!
    var neg_black = {
      type: 'image-button-response',
      stimulus: 'img/1neg_blk.jpg',
      choices: ['Continue'],
      post_trial_gap:2500,
    };

  timeline.push(neg_black);

  var pre_block1 = {
    type: 'html-button-response',
    stimulus: 'You will now hear the first group of song clip. ' +
        'After each clip, please select a number from 1-7 that best reflects ' +
        'how much you liked the song. '+
        'Press continue to begin block one.',
    choices: ['Continue'],
  };
  timeline.push(pre_block1);

//not organized by artist race yet!!
  var trial_block1 = {
    timeline: [
      {
        type: 'audio-button-response',
        stimulus: jsPsych.timelineVariable('clip'),
        choices: ['1- Hated it','2','3','4','5','6','7- Loved it'],
        prompt: '<p>What did you think of this song?</p>',
      },
    ],
    timeline_variables: [
      { clip: 'sound/Made Like This_02'},
      { clip: 'sound/Lyla Lou_02'},
      { clip: 'sound/Karola_02.wav'},
      { clip: 'sound/Everyday_02.wav'},
      { clip: 'sound/Biding her time _02.wav'},
      { clip: 'sound/j Uh!_02.wav'},
      { clip: 'sound/When Me A Move _02.wav'},
      { clip: 'sound/Kopla ja kummisetA$_ _02.wav'},
      { clip: 'sound/Turn Your Radio On _02.wav'},
      { clip: 'sound/Just Keep It Up _02.wav'},
      { clip: 'sound/NAPSo Adianta _02.wav'},
      { clip: 'sound/Horns of the Buul _02.wav'},
      { clip: 'sound/Sing Me Softly of the Blues _02.wav'},
      { clip: 'sound/Duh Duh Da _02.wav'},
      { clip: 'sound/Iki Tas Corba _02.wav'},
      { clip: 'sound/Wicked Little Town _02.wav'},
      { clip: 'sound/Out Of My Darkness _02.wav'},
      { clip: 'sound/Piracy_02.wav'},
      { clip: 'sound/YksinA$_isin_02.wav'},
      { clip: 'sound/Morning _02.wav'},
      { clip: 'sound/Blood Will Fall_02.wav'},
      { clip: 'sound/When Jesus Comes Calling For Me _02.wav'},
      { clip: 'sound/No Love To Give _02.wav'},
      { clip: 'sound/Dubrovnic_02.wav'},
      { clip: 'sound/Estoy AquA_02.wav'},
      { clip: 'sound/Sleeping My Day Away _02.wav'},
      { clip: 'sound/Cero Codazos_02.wav'}
    ],
    randomize_order: true,
  };
timeline.push(trial_block1);

var pre_block2 = {
  type: 'instructions',
  pages: [
    'You have reached the end of block one. Feel free to take a short break if you need one, ' +
    'and when you are ready to move on click next to begin block two. ',
    'Remember, after listening to each clip please select a number from 1-7 that best reflects ' +
    'how much you liked the song.',
  ],
  post_trial_gap: 1500,
  show_clickable_nav: true
};
timeline.push(pre_block2);

var trial_block2 = {
  timeline: [
    {
      type: 'audio-button-response',
      stimulus: jsPsych.timelineVariable('clip2'),
      choices: ['1- Hated it','2','3','4','5','6','7- Loved it'],
      prompt: '<p>What did you think of this song?</p>',
    },
  ],
  timeline_variables: [
    { clip2: 'sound/Lyla Lou_01.wav'},
    { clip2: 'sound/Karola_01.wav'},
    { clip2: 'sound/Everyday_01.wav'},
    { clip2: 'sound/Biding her time _01.wav'}
    { clip2: 'sound/Gentle_ the Night _01.wav'},
    { clip2: 'sound/Wicked Little Town _01.wav'},
    { clip2: 'sound/When Me A Move _01.wav'},
    { clip2: 'sound/Dubrovnic_01.wav'},
    { clip2: 'sound/Made Like This_01.wav'},
    { clip2: 'sound/Iki Tas Corba _01.wav'},
    { clip2: 'sound/Estoy AquA_01.wav'},
    { clip2: 'sound/The Sukkubus Lustrate _01.wav'},
    { clip2: 'sound/Rock N Roll _01.wav'},
    { clip2: 'sound/Turntable Terrorist _01.wav'},
    { clip2: 'sound/NAPSo Adianta _01.wav'},
    { clip2: 'sound/Lake Of Dreams _01.wav'},
    { clip2: 'sound/This Train (Munk Edit)_01.wav'},
    { clip2: 'sound/Duh Duh Da _01.wav'},
    { clip2: 'sound/The Thrill is Gone _01.wav'},
    { clip2: 'sound/A Little Tear _01.wav'},
    { clip2: 'sound/The Loco Motion _01.wav'},
    { clip2: 'sound/When Jesus Comes Calling For Me _01.wav'},
    { clip2: 'sound/Atotonilco _01.wav'},
    { clip2: 'sound/INAWIWY_01.wav'},
    { clip2: 'sound/Sunday In Marin _01.wav'},
    { clip2: 'sound/Blood Will Fall _01.wav'}
  ],
  randomize_order: true,
};
timeline.push(trial_block2);

  var rest_screen3 = {
    type: 'html-button-response',
    stimulus: 'You have reached the end of block two. When you are ready, click next to begin the brief exit survey.',
    choices: ['next'],
    post_trial_gap: 1500
  };
  timeline.push(rest_screen3);

var exit_survey = {
  timeline: [
{
  type: 'survey-likert',
  questions: [{prompt: "I favor open housing laws that allow more racial integration of neighborhoods.", labels: scale_1},
    {prompt: "Some Black people are so touchy about race that it is difficult to get along with them.", labels: scale_1},
    {prompt: "I would rather not have Black people live in the same apartment building I live in.", labels: scale_1}],
  },
  {
    {prompt: "It would not bother me if my new roommate was Black.", labels: scale_1},
    {prompt: "White people should support Black people in their struggle against discrimination and segregation.", labels: scale_1},
    {prompt: "Generally, Black people are not as smart as White people.", labels: scale_1}],
},
{
  type: 'survey-likert',
  questions: [{prompt: "Black and White people are inherently equal.", labels: scale_1},
    {prompt: "I enjoy a funny racial joke, even if some people might find it offensive.", labels: scale_1},
    {prompt: "I would probably feel somewhat self-conscious dancing with a Black person in a public place.", labels: scale_1},
    {prompt: "I think that Black people look more similar to each other than White people do.", labels: scale_1}],
},
{
    type: 'survey-likert',
    questions: [{prompt: "How warm or cold do you feel towards white people?", labels: scale_2},
    {prompt: "How warm or cold do you feel towards black people?", labels: scale_2},
    {prompt: "Which statement best describes you?", labels: scale_3}],
},
};
timeline.push(exit_survey);

  var welcome_iat = {
    type: 'html-keyboard-response',
    stimulus: '<p>In this section you will ' +
    'complete an Implicit Association Test (IAT) in which you ' +
    'will be asked to sort pictures and words into groups as ' +
    'fast as you can.</p><p>Press any key to begin.</p>',
    post_trial_gap: 1500
  };
  timeline.push(welcome_iat);

//start IAT
  var category_block = {
    type: 'html-keyboard-response',
    stimulus: '<p>Next, you will use the "E" and "I" computer keys ' + 'to categorize items into groups as fast as you can. ' +
    'These are the four groups and the items that belong to each:<br><br>' +
    '<strong>Good</strong>:<br>' + 'Triumph, Glorious, Pleasing, Delightful, Terrific, Friend,' +
    'Joyous, Love,<br><br>' + '<strong>Bad</strong>:<br>' + 'Nasty, ' +
    'Hatred, Sickening, Humiliate, Selfish, Dirty, Rotten, Despise<br><br>' +
    '<strong>Black People</strong>:<br>' + "<img src='img/bf14_nc.jpg'></img>  " +
    "<img src='img/bf23_nc.jpg'></img>  " + "<img src='img/bf56_nc.jpg'></img>  " +
    "<img src='img/bm14_nc.jpg'></img>  " + "<img src='img/bm23_nc.jpg'></img>  " +
    "<img src='img/bm56_nc.jpg'></img><br><br>" + '<strong>White People</strong>:<br>' +
    "<img src='img/wf2_nc.jpg'></img>  " + "<img src='img/wf3_nc.jpg'></img>  " +
    "<img src='img/wf6_nc.jpg'></img>  " + "<img src='img/wm1_nc.jpg'></img>  " +
    "<img src='img/wm4_nc.jpg'></img>  " + "<img src='img/wm6_nc.jpg'></img><br><br>" +
    "Press any key to continue.</p>",
    post_trial_gap: 1500
  };

  var instructions_block2 = {
    type: 'html-keyboard-response',
    stimulus: "<div style='position: absolute; top: 18%; left: 20%'><p>Press E for:<br><strong>White people</strong></p></div>" +
    "<div style='position: absolute; top: 18%; right: 20%'><p>Press I for:<br><strong>Black people</strong></p></div>" +
    "<div style='position: relative; top: 42%; margin-left: auto; margin-right: auto'>Put a left finger on the <strong>E</strong> key for items that belong to the White People category. Put a right finger on the " +
    "<strong>I</strong> key for items that belong to the Black People " +
    "category. Items will appear one at a time.<br><br>" + "If you " +
    "make a mistake, a red X will appear. Press the keys listed below " +
    "to continue. Go as fast as you can while being accurate.<br><br> " +
    "Press the any key when you are ready to start.</div>",
  };
  timeline.push(instructions_block2)


  var trial_block = {
    timeline: [
      {
        type: 'iat-image',
        stimulus: jsPsych.timelineVariable('stimulus'),
        stim_key_association: jsPsych.timelineVariable('stim_key_association'),
        html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
        bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
        force_correct_key_press: true,
        display_feedback: true,
        trial_duration: 3000, //Only if display_feedback is false
        left_category_key: 'E',
        right_category_key: 'I',
        left_category_label: ['WHITE'],
        right_category_label: ['BLACK'],
        response_ends_trial: true,
        data: { iat_type: 'practice' }
      }
    ],
    timeline_variables: [
      {stimulus: "img/wf2_nc.jpg", stim_key_association: "left"},
      {stimulus: "img/wf3_nc.jpg", stim_key_association: "left"},
      {stimulus: "img/wf6_nc.jpg", stim_key_association: "left"},
      {stimulus: "img/wm1_nc.jpg", stim_key_association: "left"},
      {stimulus: "img/wm4_nc.jpg", stim_key_association: "left"},
      {stimulus: "img/wm6_nc.jpg", stim_key_association: "left"},
      {stimulus: "img/bf14_nc.jpg", stim_key_association: "right"},
      {stimulus: "img/bf23_nc.jpg", stim_key_association: "right"},
      {stimulus: "img/bf56_nc.jpg", stim_key_association: "right"},
      {stimulus: "img/bm14_nc.jpg", stim_key_association: "right"},
      {stimulus: "img/bm23_nc.jpg", stim_key_association: "right"},
      {stimulus: "img/bm56_nc.jpg", stim_key_association: "right"}
    ],
    randomize_order: true,
    repetitions: 2
  };

  var instructions_block2 = {
    type: 'html-keyboard-response',
    stimulus: "<div style='position: absolute; top: 18%; left: 20%'>Press E for:<br><strong>Bad</strong></div>" +
    "<div style='position: absolute; top: 18%; right: 20%'>Press I for:<br><strong>Good</strong></div>" +
    "<div style='position: relative; top: 42%; margin-left: auto; margin-right: auto'>Put a left finger on the <strong>E</strong> key for items that " +
    "belong to the BAD category. Put a right finger on the " +
    "<strong>I</strong> key for items that belong to the GOOD" +
    "category. Items will appear one at a time.<br><br>" + "If you " +
    "make a mistake, a red X will appear. Press the keys listed below " +
    "to continue. Go as fast as you can while being accurate.<br><br> " +
    "Press the any key when you are ready to start.</div>",
  };

  var trial_block2 = {
    timeline: [
      {
        type: 'iat-html',
        stimulus: jsPsych.timelineVariable('stimulus'),
        stim_key_association: jsPsych.timelineVariable('stim_key_association'),
        html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
        bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
        force_correct_key_press: true,
        display_feedback: true,
        trial_duration: 3000, //Only if display_feedback is false
        left_category_key: 'E',
        right_category_key: 'I',
        left_category_label: ['BAD'],
        right_category_label: ['GOOD'],
        response_ends_trial: true,
        data: { iat_type: 'practice' }
      }
    ],
    timeline_variables: [
      {stimulus: "Humiliate", stim_key_association: "left"},
      {stimulus: "Nasty", stim_key_association: "left"},
      {stimulus: "Hatred", stim_key_association: "left"},
      {stimulus: "Sickening", stim_key_association: "left"},
      {stimulus: "Selfish", stim_key_association: "left"},
      {stimulus: "Dirty", stim_key_association: "left"},
      {stimulus: "Rotten", stim_key_association: "left"},
      {stimulus: "Despise", stim_key_association: "left"},
      {stimulus: "Triumph", stim_key_association: "right"},
      {stimulus: "Glorious", stim_key_association: "right"},
      {stimulus: "Pleasing", stim_key_association: "right"},
      {stimulus: "Delightful", stim_key_association: "right"},
      {stimulus: "Terrific", stim_key_association: "right"},
      {stimulus: "Friend", stim_key_association: "right"},
      {stimulus: "Love", stim_key_association: "right"},
      {stimulus: "Joyous", stim_key_association: "right"}
    ],
    randomize_order: true,
    repetitions: 2
  };

  var instructions_block3 = {
    type: 'html-keyboard-response',
    stimulus: "<div style='position: absolute; top: 18%; left: 20%'>Press E for:<br> " +
    "<strong>BAD</strong><br>" + "or<br>" + "<strong>White People</strong></div>" + "<div style='position: absolute; top: 18%; right: 20%'>" +
    "Press I for:<br>" + "<strong>GOOD</strong><br>" + "or<br>" + "<strong>Black People</strong></div>" +
    "<div style='position: relative; top: 42%; margin-left: auto; margin-right: auto'>Use <strong>E</strong> for Bad and for " +
    "White People<br>" + "Use <strong>I</strong> for Good and for Black People<br>" +
    "Each item belongs to only one category.<br><br>" + "If you " +
    "make a mistake, a red X will appear. Press the keys listed below " +
    "to continue. Go as fast as you can while being accurate.<br><br> " +
    "Press the any key when you are ready to start.</div>",
  };

  var trial_block3 = {
    timeline: [
      {
        type: jsPsych.timelineVariable('type'),
        stimulus: jsPsych.timelineVariable('stimulus'),
        stim_key_association: jsPsych.timelineVariable('stim_key_association'),
        html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
        bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
        force_correct_key_press: true,
        display_feedback: true,
        trial_duration: 3000, //Only if display_feedback is false
        left_category_key: 'E',
        right_category_key: 'I',
        left_category_label: ['BAD', 'WHITE'],
        right_category_label: ['GOOD', 'BLACK'],
        response_ends_trial: true,
        data: { iat_type: 'practice' }
      }
    ],
    timeline_variables: [
      {type: 'iat-image', stimulus: "img/wf2_nc.jpg", stim_key_association: "left"},
      {type: 'iat-image', stimulus: "img/wf3_nc.jpg", stim_key_association: "left"},
      {type: 'iat-image', stimulus: "img/wf6_nc.jpg", stim_key_association: "left"},
      {type: 'iat-image', stimulus: "img/wm1_nc.jpg", stim_key_association: "left"},
      {type: 'iat-image', stimulus: "img/wm4_nc.jpg", stim_key_association: "left"},
      {type: 'iat-image', stimulus: "img/wm6_nc.jpg", stim_key_association: "left"},
      {type: 'iat-image', stimulus: "img/bf14_nc.jpg", stim_key_association: "right"},
      {type: 'iat-image', stimulus: "img/bf23_nc.jpg", stim_key_association: "right"},
      {type: 'iat-image', stimulus: "img/bf56_nc.jpg", stim_key_association: "right"},
      {type: 'iat-image', stimulus: "img/bm14_nc.jpg", stim_key_association: "right"},
      {type: 'iat-image', stimulus: "img/bm23_nc.jpg", stim_key_association: "right"},
      {type: 'iat-image', stimulus: "img/bm56_nc.jpg", stim_key_association: "right"},
      {type: 'iat-html', stimulus: "Humiliate", stim_key_association: "left"},
      {type: 'iat-html', stimulus: "Nasty", stim_key_association: "left"},
      {type: 'iat-html', stimulus: "Hatred", stim_key_association: "left"},
      {type: 'iat-html', stimulus: "Sickening", stim_key_association: "left"},
      {type: 'iat-html', stimulus: "Selfish", stim_key_association: "left"},
      {type: 'iat-html', stimulus: "Dirty", stim_key_association: "left"},
      {type: 'iat-html', stimulus: "Rotten", stim_key_association: "left"},
      {type: 'iat-html', stimulus: "Despise", stim_key_association: "left"},
      {type: 'iat-html', stimulus: "Triumph", stim_key_association: "right"},
      {type: 'iat-html', stimulus: "Glorious", stim_key_association: "right"},
      {type: 'iat-html', stimulus: "Pleasing", stim_key_association: "right"},
      {type: 'iat-html', stimulus: "Delightful", stim_key_association: "right"},
      {type: 'iat-html', stimulus: "Terrific", stim_key_association: "right"},
      {type: 'iat-html', stimulus: "Friend", stim_key_association: "right"},
      {type: 'iat-html', stimulus: "Love", stim_key_association: "right"},
      {type: 'iat-html', stimulus: "Joyous", stim_key_association: "right"}
    ],
    randomize_order: true,
    repetitions: 1
  };

  var instructions_block4 = {
    type: 'html-keyboard-response',
    stimulus: "<div style='position: absolute; top: 18%; left: 20%'>Press E for:<br> " +
    "<strong>BAD</strong><br>" + "or<br>" + "<strong>White people</strong></div>" + "<div style='position: absolute; top: 18%; right: 20%'>" +
    "Press I for:<br>" + "<strong>GOOD</strong><br>" + "or<br>" + "<strong>Black people</strong></div>" +
    "<div style='position: relative; top: 42%; margin-left: auto; margin-right: auto'>This is the same as the previous part.<br>" + "Use <strong>E</strong> for Bad and for " +
    "White People<br>" + "Use <strong>I</strong> for Good and for Black People<br>" +
    "Each item belongs to only one category.<br><br>" + "If you " +
    "make a mistake, a red X will appear. Press the keys listed below " +
    "to continue. Go as fast as you can while being accurate.<br><br> " +
    "Press the any key when you are ready to start.</div>",
  };

  var trial_block4 = {
    timeline: [
        {
          type: jsPsych.timelineVariable('type'),
          is_html: jsPsych.timelineVariable('is_html'),
          stimulus: jsPsych.timelineVariable('stimulus'),
          stim_key_association: jsPsych.timelineVariable('stim_key_association'),
          html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
          bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
          force_correct_key_press: true,
          display_feedback: true,
          trial_duration: 3000, //Only if display_feedback is false
          left_category_key: 'E',
          right_category_key: 'I',
          left_category_label: ['BAD', 'WHITE'],
          right_category_label: ['GOOD', 'BLACK'],
          response_ends_trial: true,
          data: { iat_type: 'bad-white' }
        }
      ],
      timeline_variables: [
        {type: 'iat-image', stimulus: "img/wf2_nc.jpg", stim_key_association: "left"},
        {type: 'iat-image', stimulus: "img/wf3_nc.jpg", stim_key_association: "left"},
        {type: 'iat-image', stimulus: "img/wf6_nc.jpg", stim_key_association: "left"},
        {type: 'iat-image', stimulus: "img/wm1_nc.jpg", stim_key_association: "left"},
        {type: 'iat-image', stimulus: "img/wm4_nc.jpg", stim_key_association: "left"},
        {type: 'iat-image', stimulus: "img/wm6_nc.jpg", stim_key_association: "left"},
        {type: 'iat-image', stimulus: "img/bf14_nc.jpg", stim_key_association: "right"},
        {type: 'iat-image', stimulus: "img/bf23_nc.jpg", stim_key_association: "right"},
        {type: 'iat-image', stimulus: "img/bf56_nc.jpg", stim_key_association: "right"},
        {type: 'iat-image', stimulus: "img/bm14_nc.jpg", stim_key_association: "right"},
        {type: 'iat-image', stimulus: "img/bm23_nc.jpg", stim_key_association: "right"},
        {type: 'iat-image', stimulus: "img/bm56_nc.jpg", stim_key_association: "right"},
        {type: 'iat-html', stimulus: "Humiliate", stim_key_association: "left"},
        {type: 'iat-html', stimulus: "Nasty", stim_key_association: "left"},
        {type: 'iat-html', stimulus: "Hatred", stim_key_association: "left"},
        {type: 'iat-html', stimulus: "Sickening", stim_key_association: "left"},
        {type: 'iat-html', stimulus: "Selfish", stim_key_association: "left"},
        {type: 'iat-html', stimulus: "Dirty", stim_key_association: "left"},
        {type: 'iat-html', stimulus: "Rotten", stim_key_association: "left"},
        {type: 'iat-html', stimulus: "Despise", stim_key_association: "left"},
        {type: 'iat-html', stimulus: "Triumph", stim_key_association: "right"},
        {type: 'iat-html', stimulus: "Glorious", stim_key_association: "right"},
        {type: 'iat-html', stimulus: "Pleasing", stim_key_association: "right"},
        {type: 'iat-html', stimulus: "Delightful", stim_key_association: "right"},
        {type: 'iat-html', stimulus: "Terrific", stim_key_association: "right"},
        {type: 'iat-html', stimulus: "Friend", stim_key_association: "right"},
        {type: 'iat-html', stimulus: "Love", stim_key_association: "right"},
        {type: 'iat-html', stimulus: "Joyous", stim_key_association: "right"}
      ],
      randomize_order: true,
      repetitions: 2
    };

    var instructions_block5 = {
      type: 'html-keyboard-response',
      stimulus: "<div style='position: absolute; top: 18%; left: 20%'>Press E for:<br>" + "<strong>Black people</strong></div>" +
      "<div style='position: absolute; top: 18%; right: 20%'>Press I for:<br>" + "<strong>White people</strong></div>" +
      "<div style='position: relative; top: 42%; margin-left: auto; margin-right: auto'>Watch out, the labels have changed positions!<br>" +
      "Use <strong>E</strong> for Black People<br>" + "Use <strong>I</strong> for White People<br><br>" +
      "If you make a mistake, a red X will appear. Press the keys listed below " +
      "to continue. Go as fast as you can while being accurate.<br><br> " +
      "Press the any key when you are ready to start.</div>"
    };

    var trial_block5 = {
      timeline: [
        {
          type: 'iat-image',
          is_html: false,
          stimulus: jsPsych.timelineVariable('stimulus'),
          stim_key_association: jsPsych.timelineVariable('stim_key_association'),
          html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
          bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
          force_correct_key_press: true,
          display_feedback: true,
          trial_duration: 3000, //Only if display_feedback is false
          left_category_key: 'E',
          right_category_key: 'I',
          left_category_label: ['BLACK'],
          right_category_label: ['WHITE'],
          response_ends_trial: true,
          data: { iat_type: 'practice' }
        }
      ],
      timeline_variables: [
        {stimulus: "img/wf2_nc.jpg", stim_key_association: "right"},
        {stimulus: "img/wf3_nc.jpg", stim_key_association: "right"},
        {stimulus: "img/wf6_nc.jpg", stim_key_association: "right"},
        {stimulus: "img/wm1_nc.jpg", stim_key_association: "right"},
        {stimulus: "img/wm4_nc.jpg", stim_key_association: "right"},
        {stimulus: "img/wm6_nc.jpg", stim_key_association: "right"},
        {stimulus: "img/bf14_nc.jpg", stim_key_association: "left"},
        {stimulus: "img/bf23_nc.jpg", stim_key_association: "left"},
        {stimulus: "img/bf56_nc.jpg", stim_key_association: "left"},
        {stimulus: "img/bm14_nc.jpg", stim_key_association: "left"},
        {stimulus: "img/bm23_nc.jpg", stim_key_association: "left"},
        {stimulus: "img/bm56_nc.jpg", stim_key_association: "left"}
      ],
      randomize_order: true,
      repetitions: 2
    };
    var instructions_block6 = {
      type: 'html-keyboard-response',
      stimulus: "<div style='position: absolute; top: 18%; left: 20%'>Press E for:<br>" + "<strong>BAD</strong><br>" + "or<br>" +
      "<strong>Black people</strong></div>" + "<div style='position: absolute; top: 18%; right: 20%'>Press I for:<br>" + "<strong>GOOD</strong><br>" + "or<br>" +
      "<strong>White people</strong></div>" +
      "<div style='position: relative; top: 42%; margin-left: auto; margin-right: auto'>Use <strong>E</strong> for Bad and for Black people<br>" +
      "Use <strong>I</strong> for Good and for White People<br><br>" +
      "If you make a mistake, a red X will appear. Press the keys listed below " +
      "to continue. Go as fast as you can while being accurate.<br><br> " +
      "Press the any key when you are ready to start.</div>"
    };

    var trial_block6 = {
      timeline: [
      {
        type: jsPsych.timelineVariable('type'),
        stimulus: jsPsych.timelineVariable('stimulus'),
        stim_key_association: jsPsych.timelineVariable('stim_key_association'),
        html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
        bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
        force_correct_key_press: true,
        display_feedback: true,
        trial_duration: 3000, //Only if display_feedback is false
        left_category_key: 'E',
        right_category_key: 'I',
        left_category_label: ['BAD', 'BLACK'],
        right_category_label: ['GOOD', 'WHITE'],
        response_ends_trial: true,
        data: {iat_type: 'practice'}
      }
      ],
      timeline_variables: [
        {type: 'iat-image', stimulus: "img/wf2_nc.jpg", stim_key_association: "right"},
        {type: 'iat-image', stimulus: "img/wf3_nc.jpg", stim_key_association: "right"},
        {type: 'iat-image', stimulus: "img/wf6_nc.jpg", stim_key_association: "right"},
        {type: 'iat-image', stimulus: "img/wm1_nc.jpg", stim_key_association: "right"},
        {type: 'iat-image', stimulus: "img/wm4_nc.jpg", stim_key_association: "right"},
        {type: 'iat-image', stimulus: "img/wm6_nc.jpg", stim_key_association: "right"},
        {type: 'iat-image', stimulus: "img/bf14_nc.jpg", stim_key_association: "left"},
        {type: 'iat-image', stimulus: "img/bf23_nc.jpg", stim_key_association: "left"},
        {type: 'iat-image', stimulus: "img/bf56_nc.jpg", stim_key_association: "left"},
        {type: 'iat-image', stimulus: "img/bm14_nc.jpg", stim_key_association: "left"},
        {type: 'iat-image', stimulus: "img/bm23_nc.jpg", stim_key_association: "left"},
        {type: 'iat-image', stimulus: "img/bm56_nc.jpg", stim_key_association: "left"},
        {type: 'iat-html', stimulus: "Humiliate", stim_key_association: "left"},
        {type: 'iat-html', stimulus: "Nasty", stim_key_association: "left"},
        {type: 'iat-html', stimulus: "Hatred", stim_key_association: "left"},
        {type: 'iat-html', stimulus: "Sickening", stim_key_association: "left"},
        {type: 'iat-html', stimulus: "Selfish", stim_key_association: "left"},
        {type: 'iat-html', stimulus: "Dirty", stim_key_association: "left"},
        {type: 'iat-html', stimulus: "Rotten", stim_key_association: "left"},
        {type: 'iat-html', stimulus: "Despise", stim_key_association: "left"},
        {type: 'iat-html', stimulus: "Triumph", stim_key_association: "right"},
        {type: 'iat-html', stimulus: "Glorious", stim_key_association: "right"},
        {type: 'iat-html', stimulus: "Pleasing", stim_key_association: "right"},
        {type: 'iat-html', stimulus: "Delightful", stim_key_association: "right"},
        {type: 'iat-html', stimulus: "Terrific", stim_key_association: "right"},
        {type: 'iat-html', stimulus: "Friend", stim_key_association: "right"},
        {type: 'iat-html', stimulus: "Love", stim_key_association: "right"},
        {type: 'iat-html', stimulus: "Joyous", stim_key_association: "right"}
      ],
      randomize_order: true,
      repetitions: 1
    };

    var instructions_block7 = {
      type: 'html-keyboard-response',
      stimulus: "<div style='position: absolute; top: 18%; left: 20%'>Press E for:<br>" + "<strong>Bad</strong><br>" + "or<br>" +
      "<strong>Black People</strong></div>" + "<div style='position: absolute; top: 18%; right: 20%'>Press I for:<br>" + "<strong>Good</strong><br>" + "or<br>" +
      "<strong>White People</strong></div>" +
      "<div style='position: relative; top: 42%; margin-left: auto; margin-right: auto'>This is the same as the previous part<br>" +
      "Use <strong>E</strong> for Bad and for Black People<br>" +
      "Use <strong>I</strong> for Good and for White People<br>" +
      "Each item belongs to only one category<br><br>" +
      "If you make a mistake, a red X will appear. Press the keys listed below " +
      "to continue. Go as fast as you can while being accurate.<br><br> " +
      "Press the any key when you are ready to start.</div>"
    };

  var trial_block7 = {
    timeline: [
    {
      type: jsPsych.timelineVariable('type'),
      is_html: jsPsych.timelineVariable('is_html'),
      stimulus: jsPsych.timelineVariable('stimulus'),
      stim_key_association: jsPsych.timelineVariable('stim_key_association'),
      html_when_wrong: '<span style="color: red; font-size: 80px">X</span>',
      bottom_instructions: '<p>If you press the wrong key, a red X will appear. Press the other key to continue</p>',
      force_correct_key_press: true,
      display_feedback: true,
      trial_duration: 3000, //Only if display_feedback is false
      left_category_key: 'E',
      right_category_key: 'I',
      left_category_label: ['BAD', 'BLACK'],
      right_category_label: ['GOOD', 'WHITE'],
      response_ends_trial: true,
      data: {iat_type: 'bad-black'}
    }
    ],
    timeline_variables: [
      {type: 'iat-image', stimulus: "img/wf2_nc.jpg", stim_key_association: "right"},
      {type: 'iat-image', stimulus: "img/wf3_nc.jpg", stim_key_association: "right"},
      {type: 'iat-image', stimulus: "img/wf6_nc.jpg", stim_key_association: "right"},
      {type: 'iat-image', stimulus: "img/wm1_nc.jpg", stim_key_association: "right"},
      {type: 'iat-image', stimulus: "img/wm4_nc.jpg", stim_key_association: "right"},
      {type: 'iat-image', stimulus: "img/wm6_nc.jpg", stim_key_association: "right"},
      {type: 'iat-image', stimulus: "img/bf14_nc.jpg", stim_key_association: "left"},
      {type: 'iat-image', stimulus: "img/bf23_nc.jpg", stim_key_association: "left"},
      {type: 'iat-image', stimulus: "img/bf56_nc.jpg", stim_key_association: "left"},
      {type: 'iat-image', stimulus: "img/bm14_nc.jpg", stim_key_association: "left"},
      {type: 'iat-image', stimulus: "img/bm23_nc.jpg", stim_key_association: "left"},
      {type: 'iat-image', stimulus: "img/bm56_nc.jpg", stim_key_association: "left"},
      {type: 'iat-html', stimulus: "Humiliate", stim_key_association: "left"},
      {type: 'iat-html', stimulus: "Nasty", stim_key_association: "left"},
      {type: 'iat-html', stimulus: "Hatred", stim_key_association: "left"},
      {type: 'iat-html', stimulus: "Sickening", stim_key_association: "left"},
      {type: 'iat-html', stimulus: "Selfish", stim_key_association: "left"},
      {type: 'iat-html', stimulus: "Dirty", stim_key_association: "left"},
      {type: 'iat-html', stimulus: "Rotten", stim_key_association: "left"},
      {type: 'iat-html', stimulus: "Despise", stim_key_association: "left"},
      {type: 'iat-html', stimulus: "Triumph", stim_key_association: "right"},
      {type: 'iat-html', stimulus: "Glorious", stim_key_association: "right"},
      {type: 'iat-html', stimulus: "Pleasing", stim_key_association: "right"},
      {type: 'iat-html', stimulus: "Delightful", stim_key_association: "right"},
      {type: 'iat-html', stimulus: "Terrific", stim_key_association: "right"},
      {type: 'iat-html', stimulus: "Friend", stim_key_association: "right"},
      {type: 'iat-html', stimulus: "Love", stim_key_association: "right"},
      {type: 'iat-html', stimulus: "Joyous", stim_key_association: "right"}
    ],
    randomize_order: true,
    repetitions: 2
  };

    var debrief_block = {
      type: "html-keyboard-response",
      stimulus: function() {
        // calculate D-score from https://faculty.washington.edu/agg/pdf/GB&N.JPSP.2003.pdf
        // first find mean RT
        var bad_white = jsPsych.data.get().filter({iat_type: 'bad-white'}).filterCustom(function(x) { return x.rt < 10000 });
        var mean_correct_responses_bad_white = bad_white.filter({correct: true}).select('rt').mean();
        var bad_black = jsPsych.data.get().filter({iat_type: 'bad-black'}).filterCustom(function(x) { return x.rt < 10000 });
        var mean_correct_responses_bad_black = bad_black.filter({correct: true}).select('rt').mean();

        // get overall sd
        var sd = bad_white.join(bad_black).filter({correct: true}).select('rt').sd();

        var d = (mean_correct_responses_bad_black - mean_correct_responses_bad_white) / sd;

        return "<p>You're done! Below is some information about how you performed.</p>"+
          "<p>When the pairs were BAD/BLACK and GOOD/WHITE, it took you an average of <strong>"+Math.floor(mean_correct_responses_bad_black)+"ms</strong> to respond.</p>"+
          "<p>When the pairs were BAD/WHITE and GOOD/BLACK, it took you an average of <strong>"+Math.floor(mean_correct_responses_bad_white)+"ms</strong> to respond.</p>"+
          "<p>Your D score, an index of performance that takes into account this difference and the overall level of variability in your responses, is <strong>"+d.toFixed(2)+"</strong></p>"+
          "<p>For reference, the Project Implicit IAT website labels D scores above 0.15 as a slight bias, scores above 0.35 as a moderate bias, and scores above 0.65 a strong bias.</p>"
      }
    };
    timeline.push(welcome_block);
    timeline.push(category_block);
    timeline.push(instructions_block);
    timeline.push(trial_block);
    timeline.push(instructions_block2);
    timeline.push(trial_block2);
    timeline.push(instructions_block3);
    timeline.push(trial_block3);
    timeline.push(instructions_block4);
    timeline.push(trial_block4);
    timeline.push(instructions_block5);
    timeline.push(trial_block5);
    timeline.push(instructions_block6);
    timeline.push(trial_block6);
    timeline.push(instructions_block7);
    timeline.push(trial_block7);
    timeline.push(debrief_block);

    var finish = {
      type: 'html-keyboard-response',
      stimulus: '<p>This concludes the experiment. Thank you for participating!</p><p>Press any key to exit.</p>',
      post_trial_gap: 10000
    };
    timeline.push(finish);


  jsPsych.init({
    timeline: timeline,
    show_progress_bar: true,
    use_webaudio: false,
    preload_audio: [audio1, audio2],
    on_finish: function(){jsPsych.data.displayData();},
    default_iti: 500
  });

  </script>
</html>
